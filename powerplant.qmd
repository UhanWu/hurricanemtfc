---
title: "powerplant"
format: revealjs
editor: visual
---

```{r}
library(tidyverse)
```

```{r}
powerplantcsv <- read_csv("Power_Plants_in_the_U.S..csv")
```
```{r}
powerTX <- powerplantcsv |>
  select(FID,Longitude, Latitude, City, County, State, PrimSource, Total_MW) |>
  filter(State == 'Texas') |>
  summarise(count = n(), totalpower = sum(Total_MW), .by = c("County",'State'))



```

```{r}
TXpop <- read.csv("TXPOP.csv") |>
  mutate(
    Counties = gsub("^\\.", "", Counties), # Remove leading dot
    Counties = gsub(" County.*$", "", Counties) # Remove " County" and everything after
  ) |>
  mutate(population = as.numeric(gsub(",", "", Estimates)))|>
  select(Counties, population)


GDPcounty <- read.csv("gdpallcounties.csv") |>
  mutate(fips = FIPS) |>
  select(fips, GDP_ALL)

fips <- read.csv("county_fips.csv")

fipsTX <- fips |>
  filter(state_name == "Texas") |>
  select(fips, county_name) |>
  mutate(county_name = gsub(" County.*$", "", county_name))

gdpTXcounty <- merge(GDPcounty, fipsTX, .by = c('fips'))
```



```{r}
TXpop
gdpTXcounty
powerTX
```
```{r}
powerTX |>
  summarise(ALLPOWER = sum(totalpower))
```


```{r}
TXcountyPower <- TXpop |>
  mutate(pop_prop = population/sum(population)) |>
  mutate(electric_prop = round((pop_prop*149783.2),3)) |>
  select(Counties, population, electric_prop) |>
  mutate(County = Counties) |>
  arrange(desc(electric_prop))


TXcountyPowergdp <- gdpTXcounty |>
  mutate(GDP_prop = GDP_ALL/sum(GDP_ALL)) |>
  mutate(electric_prop = round((GDP_prop*149783.2),3)) |>
  select(county_name, GDP_ALL, electric_prop) |>
  arrange(desc(electric_prop)) |>
  mutate(County = county_name) 
```

```{r}
TXcountyPower

merge(powerTX, TXcountyPower, by = c("County"), all = TRUE) |>
  select(County, count, totalpower, electric_prop) |>
  mutate_all(~replace(., is.na(.), 0)) |>
  mutate(deficit = totalpower - electric_prop) |>
  arrange(deficit)
```













